<div class="page">
  <!-- Add/Edit Form (Full Mode Only) -->
  <section *ngIf="!displayOnly" class="card goal-form">
    <div class="grid grid-3">
      <input class="input" type="text" [(ngModel)]="newGoal.name" placeholder="Goal name" />
      <input class="input" type="number" [(ngModel)]="newGoal.target" placeholder="Target amount" min="0" />
      <select class="select" [(ngModel)]="newGoal.currency">
        <option value="RSD">RSD</option>
        <option value="EUR">€ EUR</option>
        <option value="USD">$ USD</option>
      </select>
    </div>

    <div class="button-row">
      <button *ngIf="!editingId" class="btn" (click)="addGoal()">Add Goal</button>
      <button *ngIf="editingId" class="btn" (click)="updateGoal()">Update</button>
      <button *ngIf="editingId" class="btn btn-ghost" (click)="cancelEdit()">Cancel</button>
    </div>
  </section>

  <div *ngIf="!displayOnly" class="card" style="display:flex;gap:1rem;align-items:center;flex-wrap:wrap;margin:.5rem 0 1rem;border:1px solid var(--c-border);padding:.6rem 1rem;">
  <div>
    <label class="label" style="margin-right:.4rem">Status</label>
    <select class="select" (change)="setStatus($any($event.target).value)">
  <option value="all">All</option>
  <option value="completed">Completed</option>
  <option value="in-progress">In progress</option>
  <option value="not-started">Not started</option>
</select>

<select class="select" (change)="setSort($any($event.target).value)">
  <option value="progress-desc">Closest to completion</option>
  <option value="progress-asc">Least completed</option>
  <option value="target-desc">Target (high → low)</option>
  <option value="target-asc">Target (low → high)</option>
  <option value="created-desc">Newest</option>
  <option value="created-asc">Oldest</option>
</select>
  </div>
</div>


  <!-- Goals List -->
  <section class="grid grid-3 goals-list">
    <article *ngFor="let goal of viewGoals$ | async; trackBy: trackById" class="goal-card card"
             class="card goal-card"
             [class.goal-complete]="goal.percent >= 100">
      <div class="goal-header">
        <strong class="goal-name">{{ goal.name }}</strong>
        <span class="goal-amounts">
          {{ goal.saved | currency:goal.currency:'symbol':'1.0-0' }}
          /
          {{ goal.target | currency:goal.currency:'symbol':'1.0-0' }}
          ({{ goal.percent | number:'1.0-0' }}%)
        </span>
      </div>

      <div class="progress-bar">
        <div class="fill" [style.width.%]="goal.percent"></div>
      </div>

      <!-- Edit/Delete Buttons (Full Mode Only) -->
      <div *ngIf="!displayOnly" class="goal-actions">
        <button class="btn" (click)="editGoal(goal)">Edit</button>
        <button class="btn btn-ghost" (click)="deleteGoal(goal.id)">Delete</button>
      </div>
    </article>
  </section>
</div>
