<h2>Finance Tracker</h2>

<!-- Finance Entry Form -->
<form [formGroup]="financeForm" (ngSubmit)="onSubmit()" class="finance-form">
  <input type="text" formControlName="description" placeholder="Description" required>
  <input type="number" formControlName="amount" placeholder="Amount" required>

  <!-- Type Dropdown -->
  <select formControlName="type">
    <option value="expense">Expense</option>
    <option value="income">Income</option>
  </select>

  <!-- Goal Dropdown -->
  <label for="goal">Associated Goal (optional):</label>
  <select formControlName="goalId">
    <option value="">-- None --</option>
    <option *ngFor="let goal of goals$ | async" [value]="goal.id">{{ goal.name }}</option>
  </select>

  <!-- Display Selected Goal -->
  <p *ngIf="selectedGoalName">Selected Goal: {{ selectedGoalName }}</p>

  <button type="submit">{{ editingId ? 'Update' : 'Add' }}</button>
  <button type="button" *ngIf="editingId" (click)="cancelEdit()">Cancel</button>
</form>

<p *ngIf="selectedGoalName">
  Selected Goal: {{ selectedGoalName }}  
  (Target: {{ selectedGoalTarget | currency:'RSD':'symbol':'1.0-0' }})
</p>

<div *ngIf="selectedGoalName" class="goal-progress">
  <p>Progress: {{ selectedGoalProgress | number:'1.0-0' }}%</p>
  <p>Remaining: {{ selectedGoalRemaining | currency:'RSD':'symbol':'1.0-0' }}</p>
  <div class="progress-bar">
    <div class="progress" [style.width.%]="selectedGoalProgress"></div>
  </div>
</div>

<!-- Filters -->
<div class="filters">
  <label>Filter by Type:</label>
  <select (change)="onFilterChange($event)">
    <option value="all">All</option>
    <option value="income">Income</option>
    <option value="expense">Expense</option>
  </select>

  <label>Filter by Month:</label>
  <select (change)="onMonthChange($event)">
    <option value="all">All</option>
    <option *ngFor="let month of availableMonths" [value]="month">{{ month }}</option>
  </select>
</div>

<!-- Finance Entries -->
<div *ngIf="(filteredEntries$ | async)?.length === 0">
  <p>No entries yet. Add one above!</p>
</div>

<ul class="entries-list">
  <li *ngFor="let entry of filteredEntries$ | async">
    {{ entry.description }} - {{ entry.amount | currency:'RSD':'symbol':'1.0-0' }} ({{ entry.type }})
    <span *ngIf="entry.goalId">
      | Goal: {{ getGoalName(entry.goalId) }}
    </span>
    <button (click)="editEntry(entry)">Edit</button>
    <button (click)="deleteEntry(entry.id)">Delete</button>
  </li>
</ul>

<!-- Summary Bar -->
<div class="summary-bar" *ngIf="totals$ | async as totals">
  <p><strong>Total Income:</strong> {{ totals.income | currency:'RSD':'symbol':'1.0-0' }}</p>
  <p><strong>Total Expenses:</strong> {{ totals.expense | currency:'RSD':'symbol':'1.0-0' }}</p>
  <p><strong>Total Savings:</strong> {{ totals.savings | currency:'RSD':'symbol':'1.0-0' }}</p>
</div>

<!-- Finance Chart -->
<app-finance-chart [totals$]="totals$"></app-finance-chart>
