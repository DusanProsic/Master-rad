<h2>Finance Tracker</h2>

<form [formGroup]="financeForm" (ngSubmit)="onSubmit()" class="form-box">
  <label>Description:</label>
  <input type="text" formControlName="description" />
  <div *ngIf="financeForm.get('description')?.invalid && financeForm.get('description')?.touched">
    <small style="color:red;">Description is required</small>
  </div>

  <label>Amount:</label>
  <input type="number" formControlName="amount" />
  <div *ngIf="financeForm.get('amount')?.invalid && financeForm.get('amount')?.touched">
    <small style="color:red;">Enter a valid amount</small>
  </div>

  <label>Type:</label>
  <select formControlName="type">
    <option value="income">Income</option>
    <option value="expense">Expense</option>
  </select>

  <br /><br />
  <button type="submit">{{ editingId ? 'Update' : 'Add Entry' }}</button>
  <button type="button" *ngIf="editingId" (click)="cancelEdit()">Cancel</button>
</form>

<hr />

<div class="filters">
  <label for="filter">Filter by Type:</label>
  <select id="filter" (change)="onFilterChange($event)">
    <option value="all">All</option>
    <option value="income">Income</option>
    <option value="expense">Expense</option>
  </select>

  <label for="month" style="margin-left:1rem;">Filter by Month:</label>
  <select id="month" (change)="onMonthChange($event)">
    <option value="all">All</option>
    <option *ngFor="let m of availableMonths" [value]="m">{{ m }}</option>
  </select>
</div>

<hr />

<div class="totals" *ngIf="totals$ | async as totals">
  <h3>Pregled finansija</h3>
  <p><strong>Prihodi:</strong> {{ totals.income | currency:'RSD':'symbol' }}</p>
  <p><strong>Troškovi:</strong> {{ totals.expense | currency:'RSD':'symbol' }}</p>
  <p><strong>Ušteda:</strong> {{ totals.savings | currency:'RSD':'symbol' }}</p>
</div>


<hr />

<h2>Saved Entries</h2>

<app-finance-chart [totals$]="totals$" />

<table *ngIf="filteredEntries$ | async as entries">
  <thead>
    <tr>
      <th>Date</th>
      <th>Type</th>
      <th>Description</th>
      <th>Amount</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let entry of entries">
      <td>{{ entry.timestamp?.toDate?.() | date: 'yyyy-MM-dd' }}</td>
      <td>{{ entry.type }}</td>
      <td>{{ entry.description }}</td>
      <td>{{ entry.amount | currency:'RSD':'symbol' }}</td>
      <td>
        <button (click)="editEntry(entry)">Edit</button>
        <button (click)="deleteEntry(entry.id)">Delete</button>
      </td>
    </tr>
  </tbody>
</table>

